# Apache Virtual Host Configuration for Laravel Apparel Store
# Save this as: /etc/apache2/sites-available/apparel-store.conf

<VirtualHost *:80>
    ServerName 13.204.86.61
    DocumentRoot /var/www/html/public
    
    # Enable Apache modules (ensure these are enabled)
    # sudo a2enmod rewrite headers deflate expires
    
    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    <Directory /var/www/html/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Ensure .htaccess files are processed
        AllowOverride FileInfo AuthConfig Limit Indexes Options=Indexes,MultiViews
    </Directory>
    
    # Deny access to sensitive directories
    <Directory /var/www/html/storage>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/bootstrap/cache>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/config>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/database>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/vendor>
        Require all denied
    </Directory>
    
    # Hide .env file
    <Files ".env*">
        Require all denied
    </Files>
    
    # Hide composer files
    <Files "composer.*">
        Require all denied
    </Files>
    
    # Hide package.json files
    <Files "package*.json">
        Require all denied
    </Files>
    
    # Hide git files
    <DirectoryMatch "\.git">
        Require all denied
    </DirectoryMatch>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/apparel-store-error.log
    CustomLog ${APACHE_LOG_DIR}/apparel-store-access.log combined
    
    # Security headers (backup in case .htaccess doesn't work)
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
</VirtualHost>

# Optional: SSL Configuration (for future HTTPS setup)
# <VirtualHost *:443>
#     ServerName 13.204.86.61
#     DocumentRoot /var/www/html/public
#     
#     SSLEngine On
#     SSLCertificateFile /path/to/certificate.crt
#     SSLCertificateKeyFile /path/to/private.key
#     
#     # Include same directory configurations as above
# </VirtualHost>